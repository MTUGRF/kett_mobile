<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Toolbar</title>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" />
    <link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css">
    <link href="https://www.dafontfree.net/embed/cGF0cmljaWFuLXJlZ3VsYXImZGF0YS8yNi9wLzEzODA1Ny9QYXRyaWNhbi50dGY" rel="stylesheet" type="text/css"/>
     <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
    <script src="https://js.arcgis.com/4.24/"></script>
    <style>
     

    /*  :root {
      --ion-font-family: 'patrician-regular';
      }*/

      #viewDiv {
        text-align: center;
        height: 100%;
        width: 100%;
        position: absolute;
        left: 0;
        right: 0;
      }

      .ion-color-primary {
        --ion-color-base:  var(--ion-color-primary, #363636)!important;
      }
    </style>
  </head>
  <body>
    <ion-app>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-buttons slot="start">
            <ion-img src="assets/kettlogo.png" style="width: 60px; height: 60px;"></ion-img>
          </ion-buttons>
          <ion-buttons slot="end">
            <ion-menu-button auto-hide="false" id="menuBtn"></ion-menu-button>
          </ion-buttons>
          <ion-popover trigger="menuBtn" dismiss-on-select="true">
          <ion-content>
            <ion-list>
              <ion-item button="true" detail="false">About the project</ion-item>
              <ion-item button="true" detail="false">Project news</ion-item>
              <ion-item button="true" detail="false">Meet the team</ion-item>              
            </ion-list>
          </ion-content>
        </ion-popover>
          <ion-title>KeTT Mobile Beta</ion-title>
        </ion-toolbar>
      </ion-header> 
      <ion-content [fullscreen]="true">
      <div id="viewDiv"></div>   
      </ion-content>    
    </ion-app>
  </body>
</html>
<script>
  require(["esri/config","esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer"], function (esriConfig,Map, MapView, FeatureLayer) {

        esriConfig.apiKey = "YOUR_API_KEY";

        // Layer for the nautical charts 
	    const indexLayer = new FeatureLayer({
	      url: "https://portal1-geo.sabu.mtu.edu/server/rest/services/Hosted/KeTT_Mobile_Map_Indexes/FeatureServer/0",
	      outFields: ["*"], // Return all fields so it can be queried client-side
	    //renderer: renderer
	    });

        const map = new Map({
          basemap: "satellite", // Basemap layer service
          layers: [indexLayer]
        });

        const view = new MapView({
          map: map,
          center: [-88.5694, 47.1211], // Longitude, latitude
          zoom: 10, // Zoom level
          container: "viewDiv" // Div element
        });       

        view.on("drag", function(evt) {
          const extent = view.extent;
          //console.log(extent);
		});

        let graphics; 
	    view.whenLayerView(indexLayer).then(function(layerView) {
  		  layerView.watch("updating", function(value) {
			  if (!value) {
			    // wait for the layer view to finish updating

			    // get all the features available for drawing.
			    layerView
			      .queryFeatures({
			        geometry: view.extent,
			        returnGeometry: true
			      })
			      .then(function(results) {
			        // do something with the resulting graphics
			        graphics = results.features;
			        console.log(graphics);
			      });
			  }
		  });	
		});

      });
</script>
<style>
  ion-content ion-toolbar {
    margin: 10px 0;
  }
</style>